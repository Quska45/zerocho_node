- 미들웨어는 익스프레스의 핵심입니다.
- 요청과 응답의 중간이라서 미들웨어라고 한다.
- 라우터와 에러 핸들러도 미들웨어의 일종이라서 미들웨어가 익스프레스의 전부라고 해도 과언이 아니다.
- 요청과 응답을 조작하거나 나쁜 요청을 거르기도 한다.

6.3.1 커스텀 미들웨어 만들기
 - 요청이 들어올 때 콘솔을 찍는 간단한 미들웨어를 만들어 본다.
 - app.js 파일에 미들웨어에 대한 내용 정리

6.3.2 morgan
 - 요청에 대한 정보를 콘솔에 기록해주는 미들웨어
 - logger()의 인자로 dev, short, common, combined 등 가능
 - 개발 시에는 dev, short / 배포시에는 common, combined 주로 사용
 - 디비 로그도 가능한데 winston을 더 많이 쓴다.

6.3.3 body-parser
 - 요청의 본문을 해석해주는 미들웨어
 - form데이터나 ajax요청의 데이터를 주로 처리
 - express에 기능이 내장되었다.
 - 단 body-parser가 필요한 경우도 있는데 RAW / Text일 경우다.
    - Raw는 버퍼 Text는 본문이 텍스트 데이터일 경우 필요한 미들웨어다.
 - url-encoded는 주소형식으로 데이터를 보내는 방식
 
    - 보통의 form전송 방식이 이걸 사용한다.
    - extended:false 방식은 노드의 querystring모듈을 사용하고 true는 qs모듈을 사용한다.
    - qs모듈이 더 확장된 기능을 가진다.
 - http만 사용하면 data와 end를 통해 스트림을 사용해야 하는데 express는 안드래도 된다. 내부적으로 처리해서 body에 붙여주기 때문
 - multipard/form 같은 형태로 온 본문은 body-parser가 해석해주지 못하기 때문에 다른 패키지를 사용해야 하는 경우도 생긴다.

6.3.4 cookie-parser
 - 요청에 동봉된 쿠키를 해석해준다.
 - 해석된 쿠키는 req.cookies 객체에 들어가게된다.
 - cookieParser()의 첫 번째 인자로 문자열을 넣어줄 수 있다.
 - 암호화된 쿠키가 있는 경우 제공한 문자열을 키로 삼아 복호화할 수 있다.
   - 서명된 쿠키를 클라이언트에서 수정할 경우 에러가 발생해 부정한 행동을 방지할 수 있다.

6.3.5 static
 - 정적인 파일을 제공한다.
 - 함수의 인자로 정적 파일들이 담겨 있는 폴더를 지정하면 된다.
 - 정적 파일들을 알아서 제공해주기 때문에 직접 읽어서 전송할 필요가 없다.
 - app.use('/img', express.static(path.join(__dirname, 'public))); 과 같이 사용시
   - 해당 주소로 바로 접근해 파일을 가져올 수 있다.
 - 요청에 대한 파일을 변경하면 파일을 전송하지만 파일을 찾지 못하면 라우터로 요청을 넘긴다.
   - 따라서 최대한 상단에 배칭해서 쓸데없이 미들웨어 라우터가 작동하지 않도록 하는 것이 좋다.
   - 하지만 서비스에 따라 용도가 다를 수 있으니 잘 고려해서 배치하다.

6.3.6 express-session
  - 세션관리용 미들웨어이다.
  - 원래 cookie-parser를 내부적으로 사용해서 cookie-parser가 먼저와야 하는데 이제는 사용안한다. 버전에 따라 위치를 고려해야 할 수도 있다.
  - 인자로 세션에 대한 설정을 받는다.
  - 예제에 사용된 설정은 코드에 있으니 확인.
  - 세션 관리 시 클라이언트에 쿠키를 보낸다. 이를 세션 쿠키라고 한다.
  - 안전하게 쿠키를 전송하려면 쿠키에 서명을 추가해야하고 쿠키를 서명하는데 secret의 값이 필요하다.
  - cookie-parser의 secret의 값과 같아야 한다.
  - req.session안에 객체를 만든다.

6.3.7 connect-flash
 - 상대적으로 중요도가 떨어지긴 한다.
 - 일회성 메시지들을 웹 브라우저에 나타낼 때 좋다.
 - req.flash에 객체를 추가한다.
 - req.flash( 키, 값 )으로 해당 키에 값을 설정한다.
 - req.flash(키)로 해당 키에 대한 값을 불러옵니다.
 - flash의 메시지는 일회성 이기 때문에 한번 사용하고 새로고침하면 사용할 수 없다.
 - 로그인 에러나 회원가입 에러 같은 일회성 경고 메시지에 사용하면 좋다.